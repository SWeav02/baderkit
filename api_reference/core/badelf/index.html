
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://sweav02.github.io/baderkit/api_reference/core/badelf/">
      
      
        <link rel="prev" href="../labeler_spin/">
      
      
        <link rel="next" href="../badelf_spin/">
      
      
        
      
      
      <link rel="icon" href="../../../images/logo.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Badelf - BaderKit Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../css/mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="deep-purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#src.baderkit.core.badelf.Badelf" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="BaderKit Documentation" class="md-header__button md-logo" aria-label="BaderKit Documentation" data-md-component="logo">
      
  <img src="../../../images/logo_icon.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BaderKit Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Badelf
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="deep-purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="deep-purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/SWeav02/baderkit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="BaderKit Documentation" class="md-nav__button md-logo" aria-label="BaderKit Documentation" data-md-component="logo">
      
  <img src="../../../images/logo_icon.svg" alt="logo">

    </a>
    BaderKit Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/SWeav02/baderkit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Bader
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Bader
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bader/usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bader/background/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Background
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bader/methods/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Methods
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    BadELF
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    BadELF
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../badelf/usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../badelf/background/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Background
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../badelf/methods/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Methods
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    ElfLabeler
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    ElfLabeler
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../elf_labeler/usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../elf_labeler/background/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Background
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" checked>
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Core
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Core
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bader/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bader
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../grid/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Grid
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../labeler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ElfLabeler
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../labeler_spin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SpinElfLabeler
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Badelf
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Badelf
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf" class="md-nav__link">
    <span class="md-ellipsis">
      
        Badelf
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.all_electride_dim_cutoffs" class="md-nav__link">
    <span class="md-ellipsis">
      
        all_electride_dim_cutoffs
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.all_electride_dims" class="md-nav__link">
    <span class="md-ellipsis">
      
        all_electride_dims
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.atom_labels" class="md-nav__link">
    <span class="md-ellipsis">
      
        atom_labels
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.avg_surface_distances" class="md-nav__link">
    <span class="md-ellipsis">
      
        avg_surface_distances
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.charges" class="md-nav__link">
    <span class="md-ellipsis">
      
        charges
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.electride_dimensionality" class="md-nav__link">
    <span class="md-ellipsis">
      
        electride_dimensionality
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.electride_formula" class="md-nav__link">
    <span class="md-ellipsis">
      
        electride_formula
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.electride_structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        electride_structure
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.electrides_per_formula" class="md-nav__link">
    <span class="md-ellipsis">
      
        electrides_per_formula
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.electrides_per_reduced_formula" class="md-nav__link">
    <span class="md-ellipsis">
      
        electrides_per_reduced_formula
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.elf_maxima" class="md-nav__link">
    <span class="md-ellipsis">
      
        elf_maxima
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.labeled_structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        labeled_structure
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.min_surface_distances" class="md-nav__link">
    <span class="md-ellipsis">
      
        min_surface_distances
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.nelectrides" class="md-nav__link">
    <span class="md-ellipsis">
      
        nelectrides
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.num_vacuum" class="md-nav__link">
    <span class="md-ellipsis">
      
        num_vacuum
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.partitioning_planes" class="md-nav__link">
    <span class="md-ellipsis">
      
        partitioning_planes
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.species" class="md-nav__link">
    <span class="md-ellipsis">
      
        species
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        structure
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.total_electron_number" class="md-nav__link">
    <span class="md-ellipsis">
      
        total_electron_number
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.total_volume" class="md-nav__link">
    <span class="md-ellipsis">
      
        total_volume
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.vacuum_charge" class="md-nav__link">
    <span class="md-ellipsis">
      
        vacuum_charge
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.vacuum_mask" class="md-nav__link">
    <span class="md-ellipsis">
      
        vacuum_mask
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.vacuum_volume" class="md-nav__link">
    <span class="md-ellipsis">
      
        vacuum_volume
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.volumes" class="md-nav__link">
    <span class="md-ellipsis">
      
        volumes
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.from_vasp" class="md-nav__link">
    <span class="md-ellipsis">
      
        from_vasp
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.get_atom_results_dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_atom_results_dataframe
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.get_oxidation_from_potcar" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_oxidation_from_potcar
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.to_dict" class="md-nav__link">
    <span class="md-ellipsis">
      
        to_dict
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.to_json" class="md-nav__link">
    <span class="md-ellipsis">
      
        to_json
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.write_all_atom_volumes" class="md-nav__link">
    <span class="md-ellipsis">
      
        write_all_atom_volumes
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.write_atom_tsv" class="md-nav__link">
    <span class="md-ellipsis">
      
        write_atom_tsv
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.write_atom_volumes" class="md-nav__link">
    <span class="md-ellipsis">
      
        write_atom_volumes
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.write_atom_volumes_sum" class="md-nav__link">
    <span class="md-ellipsis">
      
        write_atom_volumes_sum
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.write_json" class="md-nav__link">
    <span class="md-ellipsis">
      
        write_json
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.write_species_volume" class="md-nav__link">
    <span class="md-ellipsis">
      
        write_species_volume
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../badelf_spin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SpinBadelf
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Plotting
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Plotting
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plotting/structure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Structure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plotting/grid/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Grid
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plotting/bader/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bader
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf" class="md-nav__link">
    <span class="md-ellipsis">
      
        Badelf
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.all_electride_dim_cutoffs" class="md-nav__link">
    <span class="md-ellipsis">
      
        all_electride_dim_cutoffs
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.all_electride_dims" class="md-nav__link">
    <span class="md-ellipsis">
      
        all_electride_dims
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.atom_labels" class="md-nav__link">
    <span class="md-ellipsis">
      
        atom_labels
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.avg_surface_distances" class="md-nav__link">
    <span class="md-ellipsis">
      
        avg_surface_distances
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.charges" class="md-nav__link">
    <span class="md-ellipsis">
      
        charges
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.electride_dimensionality" class="md-nav__link">
    <span class="md-ellipsis">
      
        electride_dimensionality
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.electride_formula" class="md-nav__link">
    <span class="md-ellipsis">
      
        electride_formula
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.electride_structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        electride_structure
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.electrides_per_formula" class="md-nav__link">
    <span class="md-ellipsis">
      
        electrides_per_formula
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.electrides_per_reduced_formula" class="md-nav__link">
    <span class="md-ellipsis">
      
        electrides_per_reduced_formula
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.elf_maxima" class="md-nav__link">
    <span class="md-ellipsis">
      
        elf_maxima
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.labeled_structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        labeled_structure
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.min_surface_distances" class="md-nav__link">
    <span class="md-ellipsis">
      
        min_surface_distances
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.nelectrides" class="md-nav__link">
    <span class="md-ellipsis">
      
        nelectrides
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.num_vacuum" class="md-nav__link">
    <span class="md-ellipsis">
      
        num_vacuum
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.partitioning_planes" class="md-nav__link">
    <span class="md-ellipsis">
      
        partitioning_planes
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.species" class="md-nav__link">
    <span class="md-ellipsis">
      
        species
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        structure
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.total_electron_number" class="md-nav__link">
    <span class="md-ellipsis">
      
        total_electron_number
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.total_volume" class="md-nav__link">
    <span class="md-ellipsis">
      
        total_volume
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.vacuum_charge" class="md-nav__link">
    <span class="md-ellipsis">
      
        vacuum_charge
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.vacuum_mask" class="md-nav__link">
    <span class="md-ellipsis">
      
        vacuum_mask
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.vacuum_volume" class="md-nav__link">
    <span class="md-ellipsis">
      
        vacuum_volume
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.volumes" class="md-nav__link">
    <span class="md-ellipsis">
      
        volumes
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.from_vasp" class="md-nav__link">
    <span class="md-ellipsis">
      
        from_vasp
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.get_atom_results_dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_atom_results_dataframe
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.get_oxidation_from_potcar" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_oxidation_from_potcar
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.to_dict" class="md-nav__link">
    <span class="md-ellipsis">
      
        to_dict
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.to_json" class="md-nav__link">
    <span class="md-ellipsis">
      
        to_json
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.write_all_atom_volumes" class="md-nav__link">
    <span class="md-ellipsis">
      
        write_all_atom_volumes
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.write_atom_tsv" class="md-nav__link">
    <span class="md-ellipsis">
      
        write_atom_tsv
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.write_atom_volumes" class="md-nav__link">
    <span class="md-ellipsis">
      
        write_atom_volumes
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.write_atom_volumes_sum" class="md-nav__link">
    <span class="md-ellipsis">
      
        write_atom_volumes_sum
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.write_json" class="md-nav__link">
    <span class="md-ellipsis">
      
        write_json
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.baderkit.core.badelf.Badelf.write_species_volume" class="md-nav__link">
    <span class="md-ellipsis">
      
        write_species_volume
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Badelf</h1>

<div class="doc doc-object doc-class">



<a id="src.baderkit.core.badelf.Badelf"></a>
    <div class="doc doc-contents first">



        <p>Class for performing charge analysis using the electron localization function
(ELF). For information on specific methods, see our <a href="https://sweav02.github.io/baderkit/">docs</a>.</p>
<p>For more in-depth ELF analysis we recommend using the ElfLabeler class.</p>
<p>This class only performs analysis on one spin system.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>reference_grid</code>
            </td>
            <td>
                  <code><span title="baderkit.core.Grid">Grid</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A badelf app Grid like object used for partitioning the unit cell
volume. Usually contains ELF.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>charge_grid</code>
            </td>
            <td>
                  <code><span title="baderkit.core.Grid">Grid</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A badelf app Grid like object used for summing charge. Usually
contains charge density.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>method</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;badelf&#39;, &#39;voronelf&#39;, &#39;zero-flux&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The method to use for partitioning electrides from the nearby
atoms.
    'badelf' (default)
        Separates electrides using zero-flux surfaces then uses
        planes at atom radii to separate atoms. This may give more reasonable
        results for atoms, particularly in ionic solids. Radii are
        calculated directly from the ELF.
    'voronelf'
        Separates both electrides and atoms using planes at atomic/electride
        radii. This is not recommended for electrides that are not
        spherical, but may provide better results for those that are.
        Radii are calculated directly from the ELF.
    'zero-flux'
        Separates electrides and atoms using zero-flux surface. This
        is the most traditional ELF analysis, but may display some
        bias towards atoms with higher ELF values. Results for electride
        sites are identical to BadELF, and the method can be significantly
        faster.</p>
              </div>
            </td>
            <td>
                  <code>&#39;zero-flux&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shared_feature_splitting_method</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;pauling&#39;, &#39;equal&#39;, &#39;dist&#39;, &#39;nearest&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The method of assigning charge from shared ELF features
such as covalent or metallic bonds. This parameter is only used with the
zero-flux method.
    'weighted_dist' (default)
        Fraction increases with decreasing distance to each atom. The
        fraction is further weighted by the radius of each atom
        calculated from the ELF
    'pauling'
        Distributes charge to neighboring atoms (calculated using CrystalNN)
        based on the pualing electronegativity of each species normalized
        such that their sum is equal to 1. If no EN is found for the
        atom a default of 2.2 is used (including for electrides).
    'equal'
        Charge is distributed equaly to each neighboring atom/electride
        (calculated using CrystalNN)
    'dist'
        Charge is distributed such that more charge is given to the
        closest atoms. Portions are determined by normalizing the sum
        of (1/dist) to each neighboring atom.
    'nearest'
        Gives all charge to the nearest atom or electride site.</p>
              </div>
            </td>
            <td>
                  <code>&#39;weighted_dist&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>elf_labeler</code>
            </td>
            <td>
                  <code><span title="dict">dict</span> | <span title="baderkit.core.ElfLabeler">ElfLabeler</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments to pass to the ElfLabeler class. This includes
parameters controlling cutoffs for electrides as well as parameters
controlling the Bader algorithm. Alternatively, an
ElfLabeler class can be passed directly. The default is {}.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/baderkit/core/badelf/badelf.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  37</span>
<span class="normal">  38</span>
<span class="normal">  39</span>
<span class="normal">  40</span>
<span class="normal">  41</span>
<span class="normal">  42</span>
<span class="normal">  43</span>
<span class="normal">  44</span>
<span class="normal">  45</span>
<span class="normal">  46</span>
<span class="normal">  47</span>
<span class="normal">  48</span>
<span class="normal">  49</span>
<span class="normal">  50</span>
<span class="normal">  51</span>
<span class="normal">  52</span>
<span class="normal">  53</span>
<span class="normal">  54</span>
<span class="normal">  55</span>
<span class="normal">  56</span>
<span class="normal">  57</span>
<span class="normal">  58</span>
<span class="normal">  59</span>
<span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Badelf</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for performing charge analysis using the electron localization function</span>
<span class="sd">    (ELF). For information on specific methods, see our [docs](https://sweav02.github.io/baderkit/).</span>

<span class="sd">    For more in-depth ELF analysis we recommend using the ElfLabeler class.</span>

<span class="sd">    This class only performs analysis on one spin system.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    reference_grid : Grid</span>
<span class="sd">        A badelf app Grid like object used for partitioning the unit cell</span>
<span class="sd">        volume. Usually contains ELF.</span>
<span class="sd">    charge_grid : Grid</span>
<span class="sd">        A badelf app Grid like object used for summing charge. Usually</span>
<span class="sd">        contains charge density.</span>
<span class="sd">    method : Literal[&quot;badelf&quot;, &quot;voronelf&quot;, &quot;zero-flux&quot;], optional</span>
<span class="sd">        The method to use for partitioning electrides from the nearby</span>
<span class="sd">        atoms.</span>
<span class="sd">            &#39;badelf&#39; (default)</span>
<span class="sd">                Separates electrides using zero-flux surfaces then uses</span>
<span class="sd">                planes at atom radii to separate atoms. This may give more reasonable</span>
<span class="sd">                results for atoms, particularly in ionic solids. Radii are</span>
<span class="sd">                calculated directly from the ELF.</span>
<span class="sd">            &#39;voronelf&#39;</span>
<span class="sd">                Separates both electrides and atoms using planes at atomic/electride</span>
<span class="sd">                radii. This is not recommended for electrides that are not</span>
<span class="sd">                spherical, but may provide better results for those that are.</span>
<span class="sd">                Radii are calculated directly from the ELF.</span>
<span class="sd">            &#39;zero-flux&#39;</span>
<span class="sd">                Separates electrides and atoms using zero-flux surface. This</span>
<span class="sd">                is the most traditional ELF analysis, but may display some</span>
<span class="sd">                bias towards atoms with higher ELF values. Results for electride</span>
<span class="sd">                sites are identical to BadELF, and the method can be significantly</span>
<span class="sd">                faster.</span>
<span class="sd">    shared_feature_splitting_method : Literal[&quot;pauling&quot;, &quot;equal&quot;, &quot;dist&quot;, &quot;nearest&quot;], optional</span>
<span class="sd">        The method of assigning charge from shared ELF features</span>
<span class="sd">        such as covalent or metallic bonds. This parameter is only used with the</span>
<span class="sd">        zero-flux method.</span>
<span class="sd">            &#39;weighted_dist&#39; (default)</span>
<span class="sd">                Fraction increases with decreasing distance to each atom. The</span>
<span class="sd">                fraction is further weighted by the radius of each atom</span>
<span class="sd">                calculated from the ELF</span>
<span class="sd">            &#39;pauling&#39;</span>
<span class="sd">                Distributes charge to neighboring atoms (calculated using CrystalNN)</span>
<span class="sd">                based on the pualing electronegativity of each species normalized</span>
<span class="sd">                such that their sum is equal to 1. If no EN is found for the</span>
<span class="sd">                atom a default of 2.2 is used (including for electrides).</span>
<span class="sd">            &#39;equal&#39;</span>
<span class="sd">                Charge is distributed equaly to each neighboring atom/electride</span>
<span class="sd">                (calculated using CrystalNN)</span>
<span class="sd">            &#39;dist&#39;</span>
<span class="sd">                Charge is distributed such that more charge is given to the</span>
<span class="sd">                closest atoms. Portions are determined by normalizing the sum</span>
<span class="sd">                of (1/dist) to each neighboring atom.</span>
<span class="sd">            &#39;nearest&#39;</span>
<span class="sd">                Gives all charge to the nearest atom or electride site.</span>
<span class="sd">    elf_labeler : dict | ElfLabeler, optional</span>
<span class="sd">        Keyword arguments to pass to the ElfLabeler class. This includes</span>
<span class="sd">        parameters controlling cutoffs for electrides as well as parameters</span>
<span class="sd">        controlling the Bader algorithm. Alternatively, an</span>
<span class="sd">        ElfLabeler class can be passed directly. The default is {}.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spin_system</span> <span class="o">=</span> <span class="s2">&quot;total&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">reference_grid</span><span class="p">:</span> <span class="n">Grid</span><span class="p">,</span>
        <span class="n">charge_grid</span><span class="p">:</span> <span class="n">Grid</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;badelf&quot;</span><span class="p">,</span> <span class="s2">&quot;voronelf&quot;</span><span class="p">,</span> <span class="s2">&quot;zero-flux&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;zero-flux&quot;</span><span class="p">,</span>
        <span class="n">shared_feature_splitting_method</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
            <span class="s2">&quot;weighted_dist&quot;</span><span class="p">,</span> <span class="s2">&quot;pauling&quot;</span><span class="p">,</span> <span class="s2">&quot;equal&quot;</span><span class="p">,</span> <span class="s2">&quot;dist&quot;</span><span class="p">,</span> <span class="s2">&quot;nearest&quot;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;weighted_dist&quot;</span><span class="p">,</span>
        <span class="n">elf_labeler</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="n">ElfLabeler</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">reference_grid</span><span class="o">.</span><span class="n">structure</span> <span class="o">==</span> <span class="n">charge_grid</span><span class="o">.</span><span class="n">structure</span>
        <span class="p">),</span> <span class="s2">&quot;Grid structures must be the same.&quot;</span>

        <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;badelf&quot;</span><span class="p">,</span> <span class="s2">&quot;voronelf&quot;</span><span class="p">,</span> <span class="s2">&quot;zero-flux&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;The method setting you chose does not exist. Please select</span>
<span class="sd">                  either &#39;badelf&#39;, &#39;voronelf&#39;, or &#39;zero-flux&#39;.</span>
<span class="sd">                  &quot;&quot;&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reference_grid</span> <span class="o">=</span> <span class="n">reference_grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">charge_grid</span> <span class="o">=</span> <span class="n">charge_grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shared_feature_splitting_method</span> <span class="o">=</span> <span class="n">shared_feature_splitting_method</span>

        <span class="c1"># We want to use the ElfLabeler. We check if an ElfLabeler class is</span>
        <span class="c1"># provided or a dict of kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labeled_structure</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">elf_labeler</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elf_labeler_kwargs</span> <span class="o">=</span> <span class="n">elf_labeler</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elf_labeler</span> <span class="o">=</span> <span class="n">ElfLabeler</span><span class="p">(</span>
                <span class="n">charge_grid</span><span class="o">=</span><span class="n">charge_grid</span><span class="p">,</span> <span class="n">reference_grid</span><span class="o">=</span><span class="n">reference_grid</span><span class="p">,</span> <span class="o">**</span><span class="n">elf_labeler</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># use provided elf labeler</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elf_labeler_kwargs</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elf_labeler</span> <span class="o">=</span> <span class="n">elf_labeler</span>
        <span class="c1"># connect the same bader class.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elf_labeler</span><span class="o">.</span><span class="n">bader</span>

        <span class="c1"># Properties that will be calculated and cached</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_structure</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_electride_structure</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_species</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_partitioning_planes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zero_flux_feature_labels_cache</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_atom_labels</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_electride_dim</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_electride_dims</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_electride_dim_cutoffs</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_nelectrons</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_charges</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volumes</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_min_surface_distances</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_avg_surface_distances</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_electrides_per_formula</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_electrides_per_reduced_formula</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_results_summary</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1">###########################################################################</span>
    <span class="c1"># Convenient Properites</span>
    <span class="c1">###########################################################################</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_sorted_structure</span><span class="p">(</span><span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Structure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sorts a labeled structure such that atoms come first followed by electrides</span>
<span class="sd">        and then covalent/metallic features.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        structure : Structure</span>
<span class="sd">            The labeled structure to sort.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Structure</span>
<span class="sd">            The sorted structure.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># For our partitioning scheme, we need the structure to be ordered as</span>
        <span class="c1"># atoms, electrides, other. This is so that the labeled grid points map</span>
        <span class="c1"># to structure indices.</span>
        <span class="n">bare_species</span> <span class="o">=</span> <span class="n">FeatureType</span><span class="o">.</span><span class="n">bare_species</span>
        <span class="n">shared_species</span> <span class="o">=</span> <span class="n">FeatureType</span><span class="o">.</span><span class="n">shared_species</span>
        <span class="n">atom_sites</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bare_electron_sites</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">shared_sites</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">structure</span><span class="p">:</span>
            <span class="n">symbol</span> <span class="o">=</span> <span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">symbol</span>
            <span class="k">if</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">bare_species</span><span class="p">:</span>
                <span class="n">bare_electron_sites</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">shared_species</span><span class="p">:</span>
                <span class="n">shared_sites</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">atom_sites</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
        <span class="c1"># get empty structure</span>
        <span class="n">new_structure</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">new_structure</span><span class="o">.</span><span class="n">remove_sites</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">structure</span><span class="p">))])</span>
        <span class="c1"># add back sites in appropriate order</span>
        <span class="k">for</span> <span class="n">sites_list</span> <span class="ow">in</span> <span class="p">[</span><span class="n">atom_sites</span><span class="p">,</span> <span class="n">bare_electron_sites</span><span class="p">,</span> <span class="n">shared_sites</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">sites_list</span><span class="p">:</span>
                <span class="n">symbol</span> <span class="o">=</span> <span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">symbol</span>
                <span class="n">coord</span> <span class="o">=</span> <span class="n">site</span><span class="o">.</span><span class="n">frac_coords</span>
                <span class="n">new_structure</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">coord</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_structure</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">labeled_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Structure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Structure</span>
<span class="sd">            The system&#39;s structure including dummy atoms representing electride</span>
<span class="sd">            sites and covalent/metallic bonds.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labeled_structure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">labeled_structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elf_labeler</span><span class="o">.</span><span class="n">get_feature_structure</span><span class="p">(</span>
                <span class="n">included_features</span><span class="o">=</span><span class="n">FeatureType</span><span class="o">.</span><span class="n">valence_types</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_labeled_structure</span> <span class="o">=</span> <span class="n">labeled_structure</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labeled_structure</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">structure</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Structure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Structure</span>
<span class="sd">            The unlabeled structure representing the system, i.e. the structure</span>
<span class="sd">            with no dummy atoms.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_structure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># NOTE: We don&#39;t just use the structure from one of the grids in</span>
            <span class="c1"># case for some reason they differ from a provided structure from</span>
            <span class="c1"># the user</span>
            <span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labeled_structure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="c1"># remove all non-atomic sites</span>
            <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">FEATURE_DUMMY_ATOMS</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">symbol_set</span><span class="p">:</span>
                    <span class="n">structure</span><span class="o">.</span><span class="n">remove_species</span><span class="p">([</span><span class="n">symbol</span><span class="p">])</span>
            <span class="n">structure</span><span class="o">.</span><span class="n">relabel_sites</span><span class="p">(</span><span class="n">ignore_uniq</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_structure</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">electride_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Structure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Structure</span>
<span class="sd">            The system&#39;s structure including dummy atoms representing electride</span>
<span class="sd">            sites.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_electride_structure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># create our elecride structure from our labeled structure.</span>
            <span class="c1"># NOTE: We don&#39;t just use the structure from the elf labeler in</span>
            <span class="c1"># case the user provided their own</span>
            <span class="n">electride_structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labeled_structure</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">symbol</span> <span class="ow">in</span> <span class="n">FeatureType</span><span class="o">.</span><span class="n">bare_species</span><span class="p">:</span>
                    <span class="n">electride_structure</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">FeatureType</span><span class="o">.</span><span class="n">bare_electron</span><span class="o">.</span><span class="n">dummy_species</span><span class="p">,</span> <span class="n">site</span><span class="o">.</span><span class="n">frac_coords</span>
                    <span class="p">)</span>

            <span class="n">electride_structure</span><span class="o">.</span><span class="n">relabel_sites</span><span class="p">(</span><span class="n">ignore_uniq</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_electride_structure</span> <span class="o">=</span> <span class="n">electride_structure</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_electride_structure</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">nelectrides</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            The number of electride sites (electride maxima) present in the system.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">electride_structure</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">species</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list[str]</span>
<span class="sd">            The species of each atom/dummy atom in the electride structure. Covalent</span>
<span class="sd">            and metallic features are not included.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">electride_structure</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">charges</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        NDArray</span>
<span class="sd">            The charge associated with each atom and electride site in the system.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_charges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_voxel_assignments</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_charges</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        NDArray</span>
<span class="sd">            The volume associated with each atom and electride site in the system.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volumes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_voxel_assignments</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volumes</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">elf_maxima</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        NDArray</span>
<span class="sd">            The maximum ELF value for each atom and electride in the system.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">elf_labeler</span><span class="o">.</span><span class="n">atom_max_values_e</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_zero_flux_feature_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        NDArray</span>
<span class="sd">            An array representing which atoms/dummy atoms each voxel point is</span>
<span class="sd">            assigned to.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zero_flux_feature_labels_cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Use the ElfLabeler&#39;s assignments.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_zero_flux_feature_labels_cache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elf_labeler</span><span class="o">.</span><span class="n">get_feature_labels</span><span class="p">(</span>
                <span class="n">included_features</span><span class="o">=</span><span class="n">FeatureType</span><span class="o">.</span><span class="n">valence_types</span><span class="p">,</span>
                <span class="n">return_structure</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">return_charge_volume</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zero_flux_feature_labels_cache</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">partitioning_planes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple | None</span>
<span class="sd">            The partitioning planes for each site in the structure as a tuple of</span>
<span class="sd">            arrays. The first array is the site the plane belongs to, the second</span>
<span class="sd">            is a point on the plane, and the third is the vector normal to the plane.</span>
<span class="sd">            None if the zero-flux method is selected.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;zero-flux&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_partitioning_planes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finding partitioning planes&quot;</span><span class="p">)</span>

            <span class="c1"># if we have an elf labeler, use its results to get partitioning</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;badelf&quot;</span><span class="p">:</span>
                <span class="n">site_indices</span><span class="p">,</span> <span class="n">neigh_indices</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">elf_labeler</span><span class="o">.</span><span class="n">nearest_neighbor_data</span>
                <span class="p">)</span>
                <span class="n">plane_points</span><span class="p">,</span> <span class="n">plane_vectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elf_labeler</span><span class="o">.</span><span class="n">_atom_nn_planes</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;voronelf&quot;</span><span class="p">:</span>
                <span class="n">site_indices</span><span class="p">,</span> <span class="n">neigh_indices</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">elf_labeler</span><span class="o">.</span><span class="n">nearest_neighbor_data_e</span>
                <span class="p">)</span>
                <span class="n">plane_points</span><span class="p">,</span> <span class="n">plane_vectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elf_labeler</span><span class="o">.</span><span class="n">_atom_nn_planes_e</span>

            <span class="c1"># we want to transform our planes to the 26 nearest neighbor cells</span>
            <span class="c1"># to ensure that we cover our unit cell.</span>
            <span class="c1"># For speed, we can remove planes that contain the entire unit cell</span>
            <span class="c1"># and we can remove a full set of planes if none of them contain any</span>
            <span class="c1"># part of the unit cell.</span>
            <span class="c1"># Finally, we can sort each plane by how much of the unit cell it slices</span>
            <span class="c1"># such that planes that are likely to reject a grid point come first</span>

            <span class="c1"># first we get wrapped planes</span>
            <span class="n">site_indices</span><span class="p">,</span> <span class="n">transforms</span><span class="p">,</span> <span class="n">plane_points</span><span class="p">,</span> <span class="n">plane_vectors</span><span class="p">,</span> <span class="n">plane_volumes</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">get_cell_wrapped_voronoi</span><span class="p">(</span>
                    <span class="n">site_indices</span><span class="o">=</span><span class="n">site_indices</span><span class="p">,</span>
                    <span class="n">plane_points</span><span class="o">=</span><span class="n">plane_points</span><span class="p">,</span>
                    <span class="n">plane_vectors</span><span class="o">=</span><span class="n">plane_vectors</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># sort planes by site, transform, and volume.</span>
            <span class="n">combined_sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">plane_volumes</span><span class="p">,</span> <span class="n">transforms</span><span class="p">,</span> <span class="n">site_indices</span><span class="p">))</span>
            <span class="n">sorted_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lexsort</span><span class="p">(</span><span class="n">combined_sort</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="n">transforms</span> <span class="o">=</span> <span class="n">transforms</span><span class="p">[</span><span class="n">sorted_indices</span><span class="p">]</span>
            <span class="n">plane_points</span> <span class="o">=</span> <span class="n">plane_points</span><span class="p">[</span><span class="n">sorted_indices</span><span class="p">]</span>
            <span class="n">plane_vectors</span> <span class="o">=</span> <span class="n">plane_vectors</span><span class="p">[</span><span class="n">sorted_indices</span><span class="p">]</span>
            <span class="n">plane_volumes</span> <span class="o">=</span> <span class="n">plane_volumes</span><span class="p">[</span><span class="n">sorted_indices</span><span class="p">]</span>

            <span class="c1"># get plane equations in cartesian coordinates</span>
            <span class="n">plane_vectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_grid</span><span class="o">.</span><span class="n">frac_to_cart</span><span class="p">(</span><span class="n">plane_vectors</span><span class="p">)</span>
            <span class="n">plane_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_grid</span><span class="o">.</span><span class="n">frac_to_cart</span><span class="p">(</span><span class="n">plane_points</span><span class="p">)</span>

            <span class="c1"># normalize vectors</span>
            <span class="n">plane_vectors</span> <span class="o">=</span> <span class="p">(</span><span class="n">plane_vectors</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">plane_vectors</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>

            <span class="c1"># calculate plane equations</span>
            <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;ij,ij-&gt;i&quot;</span><span class="p">,</span> <span class="n">plane_vectors</span><span class="p">,</span> <span class="n">plane_points</span><span class="p">)</span>

            <span class="n">plane_equations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">plane_vectors</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_partitioning_planes</span> <span class="o">=</span> <span class="p">(</span><span class="n">site_indices</span><span class="p">,</span> <span class="n">transforms</span><span class="p">,</span> <span class="n">plane_equations</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_partitioning_planes</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">atom_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        NDArray</span>
<span class="sd">            A 3D array with the same shape as the charge grid indicating</span>
<span class="sd">            which atom/electride each grid point is assigned to.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atom_labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_voxel_assignments</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atom_labels</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_voxel_assignments</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Gets a dataframe of voxel assignments. The dataframe has columns</span>
<span class="sd">            [x, y, z, charge, sites].</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># make sure we&#39;ve run our partitioning (for logging clarity)</span>
        <span class="p">(</span>
            <span class="n">site_indices</span><span class="p">,</span>
            <span class="n">site_transforms</span><span class="p">,</span>
            <span class="n">plane_equations</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partitioning_planes</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Beginning voxel assignment&quot;</span><span class="p">)</span>

        <span class="c1"># get the zero-flux labels as a starting point</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zero_flux_feature_labels</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;zero-flux&quot;</span><span class="p">:</span>
            <span class="c1"># we are done here and can assign charges/volumes immediately</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_atom_labels</span> <span class="o">=</span> <span class="n">labels</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_charges</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volumes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elf_labeler</span><span class="o">.</span><span class="n">get_charges_and_volumes</span><span class="p">(</span>
                <span class="n">splitting_method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shared_feature_splitting_method</span><span class="p">,</span>
                <span class="n">use_electrides</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># In badelf, we want to label our electride basins ahead of time</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;badelf&quot;</span><span class="p">:</span>
                <span class="c1"># get a mask only at electride indices</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">i</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">electride_structure</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1"># set regions where we don&#39;t want to use zero-flux results to -1</span>
                <span class="n">labels</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="c1"># get the number of atoms in the partitioning structure</span>
                <span class="n">structure_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;voronelf&quot;</span><span class="p">:</span>
                <span class="c1"># we are using the voronoi method with the plane method and don&#39;t want</span>
                <span class="c1"># to override anything</span>
                <span class="n">structure_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">electride_structure</span><span class="p">)</span>

            <span class="c1"># calculate the maximum distance in fractional coords from the center of</span>
            <span class="c1"># a voxel to its edges</span>
            <span class="n">voxel_dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_grid</span><span class="o">.</span><span class="n">max_point_dist</span> <span class="o">+</span> <span class="mf">1e-12</span>

            <span class="c1"># get the transforms within a set radius</span>
            <span class="n">min_radius</span> <span class="o">=</span> <span class="n">voxel_dist</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="n">max_radius</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">abc</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="n">max_radius</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_radius</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)</span>  <span class="c1"># cap radius for large cells</span>
            <span class="n">sphere_transforms</span><span class="p">,</span> <span class="n">transform_dists</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reference_grid</span><span class="o">.</span><span class="n">get_radial_neighbor_transforms</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="n">max_radius</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">valid_mask</span> <span class="o">=</span> <span class="n">transform_dists</span> <span class="o">&gt;=</span> <span class="n">min_radius</span>
            <span class="n">sphere_transforms</span> <span class="o">=</span> <span class="n">sphere_transforms</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">valid_mask</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">transform_dists</span> <span class="o">=</span> <span class="n">transform_dists</span><span class="p">[</span><span class="n">valid_mask</span><span class="p">]</span>

            <span class="c1"># get the indices at which new transform dists occur</span>
            <span class="n">transform_breaks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">transform_dists</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">transform_dists</span><span class="p">[</span><span class="mi">1</span><span class="p">:])[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Now calculate labels, charges, and volumes assigned to each feature</span>
            <span class="n">labels</span><span class="p">,</span> <span class="n">charges</span><span class="p">,</span> <span class="n">volumes</span> <span class="o">=</span> <span class="n">get_badelf_assignments</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">charge_grid</span><span class="o">.</span><span class="n">total</span><span class="p">,</span>
                <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
                <span class="n">site_indices</span><span class="o">=</span><span class="n">site_indices</span><span class="p">,</span>
                <span class="n">site_transforms</span><span class="o">=</span><span class="n">site_transforms</span><span class="p">,</span>
                <span class="n">plane_equations</span><span class="o">=</span><span class="n">plane_equations</span><span class="p">,</span>
                <span class="n">vacuum_mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vacuum_mask</span><span class="p">,</span>
                <span class="n">min_plane_dist</span><span class="o">=</span><span class="n">voxel_dist</span><span class="p">,</span>
                <span class="n">num_assignments</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">electride_structure</span><span class="p">),</span>
                <span class="n">lattice_matrix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_grid</span><span class="o">.</span><span class="n">matrix</span><span class="p">,</span>
                <span class="n">sphere_transforms</span><span class="o">=</span><span class="n">sphere_transforms</span><span class="p">,</span>
                <span class="n">transform_dists</span><span class="o">=</span><span class="n">transform_dists</span><span class="p">,</span>
                <span class="n">transform_breaks</span><span class="o">=</span><span class="n">transform_breaks</span><span class="p">,</span>
                <span class="n">max_label</span><span class="o">=</span><span class="n">structure_len</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># convert charges/volumes to correct units</span>
            <span class="n">charges</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_grid</span><span class="o">.</span><span class="n">ngridpts</span>
            <span class="n">volumes</span> <span class="o">=</span> <span class="n">volumes</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">volume</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_grid</span><span class="o">.</span><span class="n">ngridpts</span>

            <span class="c1"># overwrite zero-flux feature charges/volumes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_atom_labels</span> <span class="o">=</span> <span class="n">labels</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_charges</span> <span class="o">=</span> <span class="n">charges</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_volumes</span> <span class="o">=</span> <span class="n">volumes</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finished voxel assignment&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">all_electride_dims</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            The possible dimensions the electride takes on from an ELF value of</span>
<span class="sd">            0 to 1. If no electrides are present the value will be None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_electride_dims</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_electride_dimensionality</span><span class="p">()</span>
        <span class="c1"># if there are no electrides we want to return None, but we don&#39;t want</span>
        <span class="c1"># to rerun the search each time. I mark the dims as -1 to avoid this</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_electride_dims</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_electride_dims</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">all_electride_dim_cutoffs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            The highest ELF value where each dimensionality in the &quot;all_electride_dims&quot;</span>
<span class="sd">            property exists.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_electride_dim_cutoffs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_electride_dimensionality</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_electride_dim_cutoffs</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_electride_dim_cutoffs</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">electride_dimensionality</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            The dimensionality of the electride volume at a value of 0 ELF.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_electride_dim</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_electride_dims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_electride_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_electride_dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_electride_dim</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_ELF_dimensionality</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">electride_mask</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span>
        <span class="n">cutoff</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        This algorithm works by checking if the voxels with values above the cutoff</span>
<span class="sd">        are connected to the equivalent voxel in the unit cell one transformation</span>
<span class="sd">        over. This is done primarily using scipy.ndimage.label which determines</span>
<span class="sd">        which voxels are connected. To do this rigorously, the unit cell is repeated</span>
<span class="sd">        to make a (2,2,2) super cell and the connections are checked going from</span>
<span class="sd">        the original unit cell to the unit cells connected at the faces, edges,</span>
<span class="sd">        and corners. If a connection in that direction is found, the total number</span>
<span class="sd">        of connections increases. Dimensionalities of 0,1,2, and 3 are represented</span>
<span class="sd">        by 0,1,4,and 13 connections respectively.</span>

<span class="sd">        NOTE: This can be made much faster with numba using an algorithm similar</span>
<span class="sd">        to that used in BaderKit to determine which atoms are surrounded. However,</span>
<span class="sd">        this would require a lot of time.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        electride_mask : np.array</span>
<span class="sd">            The ELF Grid object with only values associated with electrides.</span>
<span class="sd">        cutoff : float</span>
<span class="sd">            The minimum elf value to consider as a connection.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            The dimensionality at the ELF cutoff.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Remove data below our cutoff</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">electride_mask</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_grid</span><span class="o">.</span><span class="n">total</span> <span class="o">&gt;=</span> <span class="n">cutoff</span><span class="p">)</span>

        <span class="c1"># if we have no features, return 0 immediately</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="c1"># get the features that sit in the mask at this value</span>
        <span class="n">feature_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electride_structure</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span> <span class="p">:]</span>
        <span class="n">feature_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">charge_grid</span><span class="o">.</span><span class="n">frac_to_grid</span><span class="p">(</span><span class="n">feature_indices</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="c1"># only use indices that are not 0</span>
        <span class="n">feature_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">feature_indices</span> <span class="k">if</span> <span class="n">mask</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]]]</span>

        <span class="c1"># if we have no electride features in the mask, immediately return 0</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature_indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="c1"># create a supercell mask and label it</span>
        <span class="n">supercell_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">labels</span><span class="p">,</span> <span class="n">num_features</span> <span class="o">=</span> <span class="n">label</span><span class="p">(</span><span class="n">supercell_mask</span><span class="p">,</span> <span class="n">structure</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>

        <span class="c1"># We are going to need to translate the above voxels and the entire unit</span>
        <span class="c1"># cell so we create a list of desired transformations</span>
        <span class="n">transformations</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># -</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># x</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># y</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># z</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># xy</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># xz</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># yz</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># xyz</span>
        <span class="p">]</span>
        <span class="n">transformations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">transformations</span><span class="p">)</span>
        <span class="n">transformations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_grid</span><span class="o">.</span><span class="n">frac_to_grid</span><span class="p">(</span><span class="n">transformations</span><span class="p">)</span>

        <span class="c1"># The unit cell can be connected to neighboring unit cells in 26 directions.</span>
        <span class="c1"># however, we only need to consider half of these as the others are symmetrical.</span>
        <span class="n">connections</span> <span class="o">=</span> <span class="p">[</span>
            <span class="c1"># surfaces (3)</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># x</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>  <span class="c1"># y</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>  <span class="c1"># z</span>
            <span class="c1"># edges (6)</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>  <span class="c1"># xy</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>  <span class="c1"># xz</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>  <span class="c1"># yz</span>
            <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># x-z</span>
            <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>  <span class="c1"># y-z</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>  <span class="c1"># -xy</span>
            <span class="c1"># corners (4)</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>  <span class="c1"># x,y,z</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>  <span class="c1"># -x,y,z</span>
            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>  <span class="c1"># x,-y,z</span>
            <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>  <span class="c1"># x,y,-z</span>
        <span class="p">]</span>
        <span class="c1"># Using these connections we can determine the dimensionality of the system.</span>
        <span class="c1"># 1 connection is 1D, 2-4 connections is 2D and 5-13 connections is 3D.</span>
        <span class="c1"># !!! These may need to be updated if I&#39;m wrong. The idea comes from</span>
        <span class="c1"># the fact that the connections should be 1, 4, and 13, but sometimes</span>
        <span class="c1"># voxelation issues result in a connection not working in one direction</span>
        <span class="c1"># while it would in the reverse direction (which isn&#39;t possible with</span>
        <span class="c1"># true symmetry). The range accounts for this possibility. The problem</span>
        <span class="c1"># might be if its possible to have for example a 2D connecting structure</span>
        <span class="c1"># with 5 connections. However, I&#39;m pretty sure that immediately causes</span>
        <span class="c1"># an increase to 3D dimensionality.</span>
        <span class="c1"># First we create a list to store potential dimensionalites based off of</span>
        <span class="c1"># each feature. We will take the highest dimensionality.</span>
        <span class="n">dimensionalities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">feature_indices</span><span class="p">:</span>
            <span class="c1"># get the labels at each transformation</span>
            <span class="n">trans_labels</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">trans</span> <span class="ow">in</span> <span class="n">transformations</span><span class="p">:</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">trans</span> <span class="o">+</span> <span class="n">coord</span>
                <span class="n">trans_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span>

            <span class="c1"># count number of connections</span>
            <span class="n">connections_num</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">connection</span> <span class="ow">in</span> <span class="n">connections</span><span class="p">:</span>
                <span class="c1"># get the feature label at each voxel</span>
                <span class="n">label1</span> <span class="o">=</span> <span class="n">trans_labels</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">label2</span> <span class="o">=</span> <span class="n">trans_labels</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="c1"># If the labels are the same, the unit cell is connected in this</span>
                <span class="c1"># direction</span>
                <span class="k">if</span> <span class="n">label1</span> <span class="o">==</span> <span class="n">label2</span><span class="p">:</span>
                    <span class="n">connections_num</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">connections_num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dimensionalities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">connections_num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">dimensionalities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">connections_num</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">dimensionalities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="mi">5</span> <span class="o">&lt;</span> <span class="n">connections_num</span> <span class="o">&lt;=</span> <span class="mi">13</span><span class="p">:</span>
                <span class="n">dimensionalities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">dimensionalities</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_electride_dimensionality</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Gets the electride dimensionalities and range of ELF values that they</span>
<span class="sd">        exist at.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: This whole method should probably be rewritten in Numba</span>
        <span class="c1"># If we have no electrides theres no reason to continue so we stop here</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finding electride dimensionality cutoffs&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nelectrides</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_all_electride_dims</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_all_electride_dim_cutoffs</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c1">###############################################################################</span>
        <span class="c1"># This section preps an ELF grid that only contains values from the electride</span>
        <span class="c1"># sites and is zero everywhere else.</span>
        <span class="c1">###############################################################################</span>

        <span class="c1"># Create a mask at electrides</span>
        <span class="n">electride_indices</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">electride_structure</span><span class="p">))</span>
        <span class="p">]</span>
        <span class="c1"># NOTE: even if we have shared features, these indices are still correct</span>
        <span class="c1"># so long as the electride sites come first</span>
        <span class="n">electride_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom_labels</span><span class="p">,</span> <span class="n">electride_indices</span><span class="p">)</span>

        <span class="c1">#######################################################################</span>
        <span class="c1"># This section scans across different cutoffs to determine what dimensionalities</span>
        <span class="c1"># exist in the electride ELF</span>
        <span class="c1">#######################################################################</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Calculating dimensionality at 0 ELF&quot;</span><span class="p">)</span>
        <span class="n">highest_dimension</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ELF_dimensionality</span><span class="p">(</span><span class="n">electride_mask</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">dimensions</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">highest_dimension</span><span class="p">)]</span>
        <span class="n">dimensions</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="c1"># Create lists for the refined dimensions</span>
        <span class="n">final_dimensions</span> <span class="o">=</span> <span class="p">[</span><span class="n">highest_dimension</span><span class="p">]</span>
        <span class="n">final_connections</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">amounts_to_change</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># We refine by guessing the cutoff is 0.5 then increasing or decreasing by</span>
        <span class="c1"># 0.25, then 0.125 etc. down to 0.000015259.</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">16</span><span class="p">):</span>
            <span class="n">amounts_to_change</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">dimension</span> <span class="ow">in</span> <span class="n">dimensions</span><span class="p">:</span>
            <span class="n">guess</span> <span class="o">=</span> <span class="mf">0.5</span>
            <span class="c1"># assume this dimension is not found</span>
            <span class="n">found_dimension</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Refining cutoff for dimension </span><span class="si">{</span><span class="n">dimension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">amounts_to_change</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">amounts_to_change</span><span class="p">)):</span>
                <span class="c1"># check what our current dimension is. If we are at a higher dimension</span>
                <span class="c1"># we need to raise the cutoff. If we are at a lower dimension or at</span>
                <span class="c1"># the dimension we need to lower it</span>
                <span class="n">current_dimension</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ELF_dimensionality</span><span class="p">(</span><span class="n">electride_mask</span><span class="p">,</span> <span class="n">guess</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">current_dimension</span> <span class="o">&gt;</span> <span class="n">dimension</span><span class="p">:</span>
                    <span class="n">guess</span> <span class="o">+=</span> <span class="n">i</span>
                <span class="k">elif</span> <span class="n">current_dimension</span> <span class="o">&lt;</span> <span class="n">dimension</span><span class="p">:</span>
                    <span class="n">guess</span> <span class="o">-=</span> <span class="n">i</span>
                <span class="k">elif</span> <span class="n">current_dimension</span> <span class="o">==</span> <span class="n">dimension</span><span class="p">:</span>
                    <span class="c1"># We have found the dimension so we add it to our lists.</span>
                    <span class="n">guess</span> <span class="o">-=</span> <span class="n">i</span>
                    <span class="n">found_dimension</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">found_dimension</span><span class="p">:</span>
                <span class="n">final_connections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">guess</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
                <span class="n">final_dimensions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dimension</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_electride_dims</span> <span class="o">=</span> <span class="n">final_dimensions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_electride_dim_cutoffs</span> <span class="o">=</span> <span class="n">final_connections</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_oxidation_from_potcar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">potcar_path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;POTCAR&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the oxidation state of each atom/electride using the</span>
<span class="sd">        electron counts of the neutral atoms provided in a POTCAR.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        potcar_path : Path | str, optional</span>
<span class="sd">            The Path to the POTCAR file. The default is &quot;POTCAR&quot;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        oxidation : list</span>
<span class="sd">            The oxidation states of each atom/electride.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if POTCAR exists in path. If not, throw warning</span>
        <span class="n">potcar_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">potcar_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">potcar_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;No POTCAR file found in the requested directory. Oxidation states cannot be calculated&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>
        <span class="c1"># get POTCAR info</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
            <span class="n">potcars</span> <span class="o">=</span> <span class="n">Potcar</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">potcar_path</span><span class="p">)</span>
        <span class="n">nelectron_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># the result is a list because there can be multiple element potcars</span>
        <span class="c1"># in the file (e.g. for NaCl, POTCAR = POTCAR_Na + POTCAR_Cl)</span>
        <span class="k">for</span> <span class="n">potcar</span> <span class="ow">in</span> <span class="n">potcars</span><span class="p">:</span>
            <span class="n">nelectron_data</span><span class="p">[</span><span class="n">potcar</span><span class="o">.</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="n">potcar</span><span class="o">.</span><span class="n">nelectrons</span>
        <span class="c1"># get valence electrons for each site in the structure</span>
        <span class="n">valence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">electride_structure</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">site</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">):</span>
            <span class="n">valence</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nelectron_data</span><span class="p">[</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">symbol</span><span class="p">]</span>
        <span class="c1"># subtract charges from valence to get oxidation</span>
        <span class="n">oxidation</span> <span class="o">=</span> <span class="n">valence</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">charges</span>
        <span class="k">return</span> <span class="n">oxidation</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_min_avg_surface_dists</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Calculates the minimum and average distance from each atom and electride</span>
<span class="sd">        to the partitioning surface.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">neigh_transforms</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_grid</span><span class="o">.</span><span class="n">point_neighbor_transforms</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="n">get_edges</span><span class="p">(</span>
            <span class="n">labeled_array</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">atom_labels</span><span class="p">,</span>
            <span class="n">neighbor_transforms</span><span class="o">=</span><span class="n">neigh_transforms</span><span class="p">,</span>
            <span class="n">vacuum_mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vacuum_mask</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_min_surface_distances</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_avg_surface_distances</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">get_min_avg_surface_dists</span><span class="p">(</span>
                <span class="n">labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">atom_labels</span><span class="p">,</span>
                <span class="n">frac_coords</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">electride_structure</span><span class="o">.</span><span class="n">frac_coords</span><span class="p">,</span>
                <span class="n">edge_mask</span><span class="o">=</span><span class="n">edges</span><span class="p">,</span>
                <span class="n">matrix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">charge_grid</span><span class="o">.</span><span class="n">matrix</span><span class="p">,</span>
                <span class="n">max_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">abc</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">min_surface_distances</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        NDArray</span>
<span class="sd">            The minimum distance from each atom or electride center to the partioning</span>
<span class="sd">            surface.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min_surface_distances</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_min_avg_surface_dists</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min_surface_distances</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">avg_surface_distances</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        NDArray</span>
<span class="sd">            The average distance from each atom or electride center to the partitioning</span>
<span class="sd">            surface.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_avg_surface_distances</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_min_avg_surface_dists</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_avg_surface_distances</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">electrides_per_formula</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The number of electride electrons for the full structure formula.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_electrides_per_formula</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">electrides_per_unit</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">electride_structure</span><span class="p">)):</span>
                <span class="n">electrides_per_unit</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">charges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_electrides_per_formula</span> <span class="o">=</span> <span class="n">electrides_per_unit</span>
        <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_electrides_per_formula</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">electrides_per_reduced_formula</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The number of electrons in the reduced formula of the structure.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_electrides_per_reduced_formula</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="p">(</span>
                <span class="n">_</span><span class="p">,</span>
                <span class="n">formula_reduction_factor</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">get_reduced_composition_and_factor</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_electrides_per_reduced_formula</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">electrides_per_formula</span> <span class="o">/</span> <span class="n">formula_reduction_factor</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_electrides_per_reduced_formula</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">electride_formula</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            A string representation of the electride formula, rounding partial charge</span>
<span class="sd">            to the nearest integer.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">formula</span><span class="si">}</span><span class="s2"> e</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">electrides_per_formula</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">total_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The total volume integrated in the system. This should match the</span>
<span class="sd">            volume of the structure. If it does not there may be a serious problem.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">volumes</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">vacuum_volume</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="c1">###########################################################################</span>
    <span class="c1"># Vacuum Properties</span>
    <span class="c1">###########################################################################</span>
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">vacuum_charge</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The charge assigned to the vacuum.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">elf_labeler</span><span class="o">.</span><span class="n">vacuum_charge</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">vacuum_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The total volume assigned to the vacuum.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">elf_labeler</span><span class="o">.</span><span class="n">vacuum_volume</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">vacuum_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        NDArray[bool]</span>
<span class="sd">            A mask representing the voxels that belong to the vacuum.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">elf_labeler</span><span class="o">.</span><span class="n">vacuum_mask</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">num_vacuum</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            The number of vacuum points in the array</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">elf_labeler</span><span class="o">.</span><span class="n">num_vacuum</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">total_electron_number</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The total number of electrons in the system calculated from the</span>
<span class="sd">            atom charges and vacuum charge. If this does not match the true</span>
<span class="sd">            total electron number within reasonable floating point error,</span>
<span class="sd">            there is a major problem.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">charges</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">vacuum_charge</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">potcar_path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;POTCAR&quot;</span><span class="p">,</span> <span class="n">use_json</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Gets a dictionary summary of the BadELF analysis.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        potcar_path : Path | str, optional</span>
<span class="sd">            The Path to a POTCAR file. This must be provided for oxidation states</span>
<span class="sd">            to be calculated, and they will be None otherwise. The default is &quot;POTCAR&quot;.</span>
<span class="sd">        use_json : bool, optional</span>
<span class="sd">            Convert all entries to JSONable data types. The default is True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            A summary of the BadELF analysis in dictionary form.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># collect method kwargs</span>
        <span class="n">method_kwargs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
            <span class="s2">&quot;shared_feature_splitting_method&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared_feature_splitting_method</span><span class="p">,</span>
            <span class="s2">&quot;elf_labeler_kwargs&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">elf_labeler_kwargs</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;method_kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">method_kwargs</span>

        <span class="c1"># only try to calculate oxidation state if this was a spin dependent system</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin_system</span> <span class="o">==</span> <span class="s2">&quot;total&quot;</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;oxidation_states&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_oxidation_from_potcar</span><span class="p">(</span><span class="n">potcar_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;oxidation_states&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># get charges first to ensure good logging</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">charges</span>

        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;species&quot;</span><span class="p">,</span>
            <span class="s2">&quot;structure&quot;</span><span class="p">,</span>
            <span class="s2">&quot;labeled_structure&quot;</span><span class="p">,</span>
            <span class="s2">&quot;electride_structure&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nelectrides&quot;</span><span class="p">,</span>
            <span class="s2">&quot;all_electride_dims&quot;</span><span class="p">,</span>
            <span class="s2">&quot;all_electride_dim_cutoffs&quot;</span><span class="p">,</span>
            <span class="s2">&quot;electride_dimensionality&quot;</span><span class="p">,</span>
            <span class="s2">&quot;charges&quot;</span><span class="p">,</span>
            <span class="s2">&quot;volumes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;elf_maxima&quot;</span><span class="p">,</span>
            <span class="s2">&quot;min_surface_distances&quot;</span><span class="p">,</span>
            <span class="s2">&quot;avg_surface_distances&quot;</span><span class="p">,</span>
            <span class="s2">&quot;electride_formula&quot;</span><span class="p">,</span>
            <span class="s2">&quot;electrides_per_formula&quot;</span><span class="p">,</span>
            <span class="s2">&quot;electrides_per_reduced_formula&quot;</span><span class="p">,</span>
            <span class="s2">&quot;total_electron_number&quot;</span><span class="p">,</span>
            <span class="s2">&quot;total_volume&quot;</span><span class="p">,</span>
            <span class="s2">&quot;spin_system&quot;</span><span class="p">,</span>
            <span class="s2">&quot;vacuum_charge&quot;</span><span class="p">,</span>
            <span class="s2">&quot;vacuum_volume&quot;</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">result</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_json</span><span class="p">:</span>
            <span class="c1"># get serializable versions of each attribute</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;structure&quot;</span><span class="p">,</span> <span class="s2">&quot;labeled_structure&quot;</span><span class="p">,</span> <span class="s2">&quot;electride_structure&quot;</span><span class="p">]:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;POSCAR&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s2">&quot;charges&quot;</span><span class="p">,</span>
                <span class="s2">&quot;volumes&quot;</span><span class="p">,</span>
                <span class="s2">&quot;elf_maxima&quot;</span><span class="p">,</span>
                <span class="s2">&quot;oxidation_states&quot;</span><span class="p">,</span>
                <span class="s2">&quot;min_surface_distances&quot;</span><span class="p">,</span>
                <span class="s2">&quot;avg_surface_distances&quot;</span><span class="p">,</span>
            <span class="p">]:</span>
                <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>  <span class="c1"># skip oxidation states if they fail</span>
                <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a JSON string representation of the results, typically for writing</span>
<span class="sd">        results to file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Keyword arguments for the to_dict method.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            A JSON string representation of the BadELF results.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">use_json</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">write_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;badelf.json&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes results of the analysis to file in a JSON format.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filepath : Path | str, optional</span>
<span class="sd">            The Path to write the results to. The default is &quot;badelf.json&quot;.</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            keyword arguments for the to_dict method.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">use_json</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="n">json_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_vasp</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">reference_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">=</span> <span class="s2">&quot;ELFCAR&quot;</span><span class="p">,</span>
        <span class="n">charge_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">=</span> <span class="s2">&quot;CHGCAR&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a BadElfToolkit instance from the requested partitioning file</span>
<span class="sd">        and charge file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        reference_file : str | Path, optional</span>
<span class="sd">            The path to the file to use for partitioning. Must be a VASP</span>
<span class="sd">            CHGCAR or ELFCAR type file. The default is &quot;ELFCAR&quot;.</span>
<span class="sd">        charge_file : str | Path, optional</span>
<span class="sd">            The path to the file containing the charge density. Must be a VASP</span>
<span class="sd">            CHGCAR or ELFCAR type file. The default is &quot;CHGCAR&quot;.</span>
<span class="sd">        **kwargs : any</span>
<span class="sd">            Additional keyword arguments for the BadElfToolkit class.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        BadElfToolkit</span>
<span class="sd">            A BadElfToolkit instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">reference_grid</span> <span class="o">=</span> <span class="n">Grid</span><span class="o">.</span><span class="n">from_vasp</span><span class="p">(</span><span class="n">reference_file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">charge_grid</span> <span class="o">=</span> <span class="n">Grid</span><span class="o">.</span><span class="n">from_vasp</span><span class="p">(</span><span class="n">charge_file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">reference_grid</span><span class="o">=</span><span class="n">reference_grid</span><span class="p">,</span> <span class="n">charge_grid</span><span class="o">=</span><span class="n">charge_grid</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">write_atom_volumes</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">atom_indices</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">write_reference</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">include_dummy_atoms</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">output_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Format</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">prefix_override</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Writes an the reference ELF or charge-density for the given atoms to</span>
<span class="sd">        separate files. Electrides found during the calculation are appended to</span>
<span class="sd">        the end of the structure.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        atom_indices : int</span>
<span class="sd">            The index of the atom/electride to write for.</span>
<span class="sd">        directory : str | Path</span>
<span class="sd">            The directory to write the files in. If None, the active directory</span>
<span class="sd">            is used.</span>
<span class="sd">        write_reference : bool, optional</span>
<span class="sd">            Whether or not to write the reference data rather than the charge data.</span>
<span class="sd">            Default is True.</span>
<span class="sd">        include_dummy_atoms : bool, optional</span>
<span class="sd">            Whether or not to add dummy files to the structure. The default is False.</span>
<span class="sd">        output_format : str | Format, optional</span>
<span class="sd">            The format to write with. If None, writes to source format stored in</span>
<span class="sd">            the Grid objects metadata.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        prefix_override : str, optional</span>
<span class="sd">            The string to add at the front of the output path. If None, defaults</span>
<span class="sd">            to the VASP file name equivalent to the data type stored in the</span>
<span class="sd">            grid.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>

        <span class="c1"># Get voxel assignments and data</span>
        <span class="n">voxel_assignment_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_labels</span>
        <span class="k">if</span> <span class="n">write_reference</span><span class="p">:</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_grid</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_grid</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># add dummy atoms if desired</span>
        <span class="k">if</span> <span class="n">include_dummy_atoms</span><span class="p">:</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electride_structure</span>

        <span class="c1"># get prefix</span>
        <span class="k">if</span> <span class="n">prefix_override</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">prefix_override</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">data_type</span><span class="o">.</span><span class="n">prefix</span>

        <span class="c1"># Get mask where the grid belongs to requested species</span>
        <span class="k">for</span> <span class="n">atom_index</span> <span class="ow">in</span> <span class="n">atom_indices</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">voxel_assignment_array</span> <span class="o">==</span> <span class="n">atom_index</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">total</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">grid</span><span class="o">.</span><span class="n">diff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">grid</span><span class="o">.</span><span class="n">diff</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">file_path</span> <span class="o">=</span> <span class="n">directory</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix_override</span><span class="si">}</span><span class="s2">_a</span><span class="si">{</span><span class="n">atom_index</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="c1"># write file</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">output_format</span><span class="o">=</span><span class="n">output_format</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">write_all_atom_volumes</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">write_reference</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">output_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Format</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">include_dummy_atoms</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">prefix_override</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">writer_kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes all atomic basins.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        directory : str | Path</span>
<span class="sd">            The directory to write the files in. If None, the active directory</span>
<span class="sd">            is used.</span>
<span class="sd">        directory : str | Path</span>
<span class="sd">            The directory to write the files in. If None, the active directory</span>
<span class="sd">            is used.</span>
<span class="sd">        write_reference : bool, optional</span>
<span class="sd">            Whether or not to write the reference data rather than the charge data.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        output_format : str | Format, optional</span>
<span class="sd">            The format to write with. If None, writes to source format stored in</span>
<span class="sd">            the Grid objects metadata.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        include_dummy_atoms : bool, optional</span>
<span class="sd">            Whether or not to include . The default is True.</span>
<span class="sd">        prefix_override : str, optional</span>
<span class="sd">            The string to add at the front of the output path. If None, defaults</span>
<span class="sd">            to the VASP file name equivalent to the data type stored in the</span>
<span class="sd">            grid.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">atom_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">electride_structure</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_volumes</span><span class="p">(</span>
            <span class="n">atom_indices</span><span class="o">=</span><span class="n">atom_indices</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">write_reference</span><span class="o">=</span><span class="n">write_reference</span><span class="p">,</span>
            <span class="n">include_dummy_atoms</span><span class="o">=</span><span class="n">include_dummy_atoms</span><span class="p">,</span>
            <span class="n">output_format</span><span class="o">=</span><span class="n">output_format</span><span class="p">,</span>
            <span class="n">prefix_override</span><span class="o">=</span><span class="n">prefix_override</span><span class="p">,</span>
            <span class="o">**</span><span class="n">writer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">write_atom_volumes_sum</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">atom_indices</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span>
        <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">write_reference</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">output_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Format</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">include_dummy_atoms</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">prefix_override</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">writer_kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Writes the reference ELF or charge-density for the the union of the</span>
<span class="sd">        given atoms to a single file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        atom_indices : int</span>
<span class="sd">            The index of the atom/electride to write for.</span>
<span class="sd">        directory : str | Path</span>
<span class="sd">            The directory to write the files in. If None, the active directory</span>
<span class="sd">            is used.</span>
<span class="sd">        write_reference : bool, optional</span>
<span class="sd">            Whether or not to write the reference data rather than the charge data.</span>
<span class="sd">            Default is True.</span>
<span class="sd">        include_dummy_atoms : bool, optional</span>
<span class="sd">            Whether or not to add dummy files to the structure. The default is False.</span>
<span class="sd">        output_format : str | Format, optional</span>
<span class="sd">            The format to write with. If None, writes to source format stored in</span>
<span class="sd">            the Grid objects metadata.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        prefix_override : str, optional</span>
<span class="sd">            The string to add at the front of the output path. If None, defaults</span>
<span class="sd">            to the VASP file name equivalent to the data type stored in the</span>
<span class="sd">            grid.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get the data to use</span>
        <span class="k">if</span> <span class="n">write_reference</span><span class="p">:</span>
            <span class="n">data_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_grid</span><span class="o">.</span><span class="n">total</span>
            <span class="n">data_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_grid</span><span class="o">.</span><span class="n">data_type</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_grid</span><span class="o">.</span><span class="n">total</span>
            <span class="n">data_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_grid</span><span class="o">.</span><span class="n">data_type</span>

        <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom_labels</span><span class="p">,</span> <span class="n">atom_indices</span><span class="p">)</span>
        <span class="n">data_array_copy</span> <span class="o">=</span> <span class="n">data_array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">data_array_copy</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">Grid</span><span class="p">(</span>
            <span class="n">structure</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="n">data_array_copy</span><span class="p">},</span>
            <span class="n">data_type</span><span class="o">=</span><span class="n">data_type</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># add dummy atoms if desired</span>
        <span class="k">if</span> <span class="n">include_dummy_atoms</span><span class="p">:</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electride_structure</span>

        <span class="c1"># get prefix</span>
        <span class="k">if</span> <span class="n">prefix_override</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">prefix_override</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">data_type</span><span class="o">.</span><span class="n">prefix</span>

        <span class="n">file_path</span> <span class="o">=</span> <span class="n">directory</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix_override</span><span class="si">}</span><span class="s2">_asum&quot;</span>
        <span class="c1"># write file</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">output_format</span><span class="o">=</span><span class="n">output_format</span><span class="p">,</span> <span class="o">**</span><span class="n">writer_kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">write_species_volume</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">write_reference</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">species</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">FeatureType</span><span class="o">.</span><span class="n">bare_electron</span><span class="o">.</span><span class="n">dummy_species</span><span class="p">,</span>
        <span class="n">include_dummy_atoms</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">output_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Format</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">prefix_override</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes an ELFCAR or CHGCAR for a given species.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        directory : str | Path, optional</span>
<span class="sd">            The directory to write the result to. The default is None.</span>
<span class="sd">        write_reference : bool, optional</span>
<span class="sd">            Whether or not to write the reference data rather than the charge data.</span>
<span class="sd">            The default is True.</span>
<span class="sd">        species : str, optional</span>
<span class="sd">            The species to write. The default is &quot;Le&quot; (the electrides).</span>
<span class="sd">        include_dummy_atoms : bool, optional</span>
<span class="sd">            Whether or not to include . The default is True.</span>
<span class="sd">        output_format : str | Format, optional</span>
<span class="sd">            The format to write with. If None, writes to source format stored in</span>
<span class="sd">            the Grid objects metadata.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        prefix_override : str, optional</span>
<span class="sd">            The string to add at the front of the output path. If None, defaults</span>
<span class="sd">            to the VASP file name equivalent to the data type stored in the</span>
<span class="sd">            grid.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>

        <span class="c1"># Get voxel assignments and data</span>
        <span class="n">voxel_assignment_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_labels</span>
        <span class="k">if</span> <span class="n">write_reference</span><span class="p">:</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_grid</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_grid</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># add dummy atoms if desired</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electride_structure</span><span class="o">.</span><span class="n">indices_from_symbol</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">include_dummy_atoms</span><span class="p">:</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electride_structure</span>
        <span class="c1"># Get mask where the grid belongs to requested species</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">voxel_assignment_array</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">total</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">grid</span><span class="o">.</span><span class="n">diff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">diff</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># get prefix</span>
        <span class="k">if</span> <span class="n">prefix_override</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">prefix_override</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">data_type</span><span class="o">.</span><span class="n">prefix</span>

        <span class="n">file_path</span> <span class="o">=</span> <span class="n">directory</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix_override</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">species</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="c1"># write file</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">output_format</span><span class="o">=</span><span class="n">output_format</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_atom_results_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collects a summary of results for the atoms in a pandas DataFrame.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        atoms_df : pd.DataFrame</span>
<span class="sd">            A table summarizing the atomic basins.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get atom results summary</span>
        <span class="n">atom_frac_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electride_structure</span><span class="o">.</span><span class="n">frac_coords</span>
        <span class="n">atoms_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">electride_structure</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span>
                <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">atom_frac_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">atom_frac_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="n">atom_frac_coords</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
                <span class="s2">&quot;charge&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">charges</span><span class="p">,</span>
                <span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">volumes</span><span class="p">,</span>
                <span class="s2">&quot;surface_dist&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_surface_distances</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">atoms_df</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">write_atom_tsv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;badelf_atoms.tsv&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a summary of atom results to .tsv files.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filepath : str | Path</span>
<span class="sd">            The Path to write the results to. The default is &quot;badelf_atoms.tsv&quot;.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

        <span class="c1"># Get atom results summary</span>
        <span class="n">atoms_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_atom_results_dataframe</span><span class="p">()</span>
        <span class="n">formatted_atoms_df</span> <span class="o">=</span> <span class="n">atoms_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">numeric_cols</span> <span class="o">=</span> <span class="n">formatted_atoms_df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s2">&quot;number&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
        <span class="n">formatted_atoms_df</span><span class="p">[</span><span class="n">numeric_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">formatted_atoms_df</span><span class="p">[</span><span class="n">numeric_cols</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Determine max width per column including header</span>
        <span class="n">col_widths</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">col</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">),</span> <span class="n">formatted_atoms_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">atoms_df</span><span class="o">.</span><span class="n">columns</span>
        <span class="p">}</span>

        <span class="c1"># Note what we&#39;re writing in log</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Writing Atom Summary to </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># write output summaries</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="c1"># Write header</span>
            <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="si">:</span><span class="s2">&lt;</span><span class="si">{</span><span class="n">col_widths</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="si">}}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">formatted_atoms_df</span><span class="o">.</span><span class="n">columns</span>
            <span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Write rows</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">formatted_atoms_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">val</span><span class="si">:</span><span class="s2">&lt;</span><span class="si">{</span><span class="n">col_widths</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="si">}}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># f.write(f&quot;Vacuum Charge:\t\t{self.vacuum_charge:.5f}\n&quot;)</span>
            <span class="c1"># f.write(f&quot;Vacuum Volume:\t\t{self.vacuum_volume:.5f}\n&quot;)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Electrons:</span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total_electron_number</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h2 id="src.baderkit.core.badelf.Badelf.all_electride_dim_cutoffs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">all_electride_dim_cutoffs</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#src.baderkit.core.badelf.Badelf.all_electride_dim_cutoffs" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The highest ELF value where each dimensionality in the "all_electride_dims"
property exists.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="src.baderkit.core.badelf.Badelf.all_electride_dims" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">all_electride_dims</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#src.baderkit.core.badelf.Badelf.all_electride_dims" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The possible dimensions the electride takes on from an ELF value of
0 to 1. If no electrides are present the value will be None.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="src.baderkit.core.badelf.Badelf.atom_labels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">atom_labels</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#src.baderkit.core.badelf.Badelf.atom_labels" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 3D array with the same shape as the charge grid indicating
which atom/electride each grid point is assigned to.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="src.baderkit.core.badelf.Badelf.avg_surface_distances" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">avg_surface_distances</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#src.baderkit.core.badelf.Badelf.avg_surface_distances" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The average distance from each atom or electride center to the partitioning
surface.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="src.baderkit.core.badelf.Badelf.charges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">charges</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#src.baderkit.core.badelf.Badelf.charges" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The charge associated with each atom and electride site in the system.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="src.baderkit.core.badelf.Badelf.electride_dimensionality" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">electride_dimensionality</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#src.baderkit.core.badelf.Badelf.electride_dimensionality" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dimensionality of the electride volume at a value of 0 ELF.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="src.baderkit.core.badelf.Badelf.electride_formula" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">electride_formula</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#src.baderkit.core.badelf.Badelf.electride_formula" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A string representation of the electride formula, rounding partial charge
to the nearest integer.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="src.baderkit.core.badelf.Badelf.electride_structure" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">electride_structure</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#src.baderkit.core.badelf.Badelf.electride_structure" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="baderkit.core.Structure">Structure</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The system's structure including dummy atoms representing electride
sites.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="src.baderkit.core.badelf.Badelf.electrides_per_formula" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">electrides_per_formula</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#src.baderkit.core.badelf.Badelf.electrides_per_formula" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of electride electrons for the full structure formula.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="src.baderkit.core.badelf.Badelf.electrides_per_reduced_formula" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">electrides_per_reduced_formula</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#src.baderkit.core.badelf.Badelf.electrides_per_reduced_formula" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of electrons in the reduced formula of the structure.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="src.baderkit.core.badelf.Badelf.elf_maxima" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">elf_maxima</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#src.baderkit.core.badelf.Badelf.elf_maxima" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum ELF value for each atom and electride in the system.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="src.baderkit.core.badelf.Badelf.labeled_structure" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">labeled_structure</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#src.baderkit.core.badelf.Badelf.labeled_structure" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="baderkit.core.Structure">Structure</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The system's structure including dummy atoms representing electride
sites and covalent/metallic bonds.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="src.baderkit.core.badelf.Badelf.min_surface_distances" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">min_surface_distances</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#src.baderkit.core.badelf.Badelf.min_surface_distances" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum distance from each atom or electride center to the partioning
surface.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="src.baderkit.core.badelf.Badelf.nelectrides" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">nelectrides</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#src.baderkit.core.badelf.Badelf.nelectrides" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of electride sites (electride maxima) present in the system.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="src.baderkit.core.badelf.Badelf.num_vacuum" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">num_vacuum</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#src.baderkit.core.badelf.Badelf.num_vacuum" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of vacuum points in the array</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="src.baderkit.core.badelf.Badelf.partitioning_planes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">partitioning_planes</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#src.baderkit.core.badelf.Badelf.partitioning_planes" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The partitioning planes for each site in the structure as a tuple of
arrays. The first array is the site the plane belongs to, the second
is a point on the plane, and the third is the vector normal to the plane.
None if the zero-flux method is selected.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="src.baderkit.core.badelf.Badelf.species" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">species</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#src.baderkit.core.badelf.Badelf.species" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The species of each atom/dummy atom in the electride structure. Covalent
and metallic features are not included.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="src.baderkit.core.badelf.Badelf.structure" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">structure</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#src.baderkit.core.badelf.Badelf.structure" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="baderkit.core.Structure">Structure</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The unlabeled structure representing the system, i.e. the structure
with no dummy atoms.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="src.baderkit.core.badelf.Badelf.total_electron_number" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">total_electron_number</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#src.baderkit.core.badelf.Badelf.total_electron_number" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total number of electrons in the system calculated from the
atom charges and vacuum charge. If this does not match the true
total electron number within reasonable floating point error,
there is a major problem.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="src.baderkit.core.badelf.Badelf.total_volume" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">total_volume</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#src.baderkit.core.badelf.Badelf.total_volume" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total volume integrated in the system. This should match the
volume of the structure. If it does not there may be a serious problem.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="src.baderkit.core.badelf.Badelf.vacuum_charge" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">vacuum_charge</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#src.baderkit.core.badelf.Badelf.vacuum_charge" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The charge assigned to the vacuum.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="src.baderkit.core.badelf.Badelf.vacuum_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">vacuum_mask</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#src.baderkit.core.badelf.Badelf.vacuum_mask" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="bool">bool</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A mask representing the voxels that belong to the vacuum.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="src.baderkit.core.badelf.Badelf.vacuum_volume" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">vacuum_volume</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#src.baderkit.core.badelf.Badelf.vacuum_volume" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total volume assigned to the vacuum.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="src.baderkit.core.badelf.Badelf.volumes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">volumes</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#src.baderkit.core.badelf.Badelf.volumes" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The volume associated with each atom and electride site in the system.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>




<div class="doc doc-object doc-function">


<h2 id="src.baderkit.core.badelf.Badelf.from_vasp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_vasp</span><span class="p">(</span><span class="n">reference_file</span><span class="o">=</span><span class="s1">&#39;ELFCAR&#39;</span><span class="p">,</span> <span class="n">charge_file</span><span class="o">=</span><span class="s1">&#39;CHGCAR&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#src.baderkit.core.badelf.Badelf.from_vasp" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Creates a BadElfToolkit instance from the requested partitioning file
and charge file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>reference_file</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the file to use for partitioning. Must be a VASP
CHGCAR or ELFCAR type file. The default is "ELFCAR".</p>
              </div>
            </td>
            <td>
                  <code>&#39;ELFCAR&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>charge_file</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the file containing the charge density. Must be a VASP
CHGCAR or ELFCAR type file. The default is "CHGCAR".</p>
              </div>
            </td>
            <td>
                  <code>&#39;CHGCAR&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="any">any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments for the BadElfToolkit class.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="BadElfToolkit">BadElfToolkit</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A BadElfToolkit instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/baderkit/core/badelf/badelf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_vasp</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">reference_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">=</span> <span class="s2">&quot;ELFCAR&quot;</span><span class="p">,</span>
    <span class="n">charge_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">=</span> <span class="s2">&quot;CHGCAR&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a BadElfToolkit instance from the requested partitioning file</span>
<span class="sd">    and charge file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    reference_file : str | Path, optional</span>
<span class="sd">        The path to the file to use for partitioning. Must be a VASP</span>
<span class="sd">        CHGCAR or ELFCAR type file. The default is &quot;ELFCAR&quot;.</span>
<span class="sd">    charge_file : str | Path, optional</span>
<span class="sd">        The path to the file containing the charge density. Must be a VASP</span>
<span class="sd">        CHGCAR or ELFCAR type file. The default is &quot;CHGCAR&quot;.</span>
<span class="sd">    **kwargs : any</span>
<span class="sd">        Additional keyword arguments for the BadElfToolkit class.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    BadElfToolkit</span>
<span class="sd">        A BadElfToolkit instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">reference_grid</span> <span class="o">=</span> <span class="n">Grid</span><span class="o">.</span><span class="n">from_vasp</span><span class="p">(</span><span class="n">reference_file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">charge_grid</span> <span class="o">=</span> <span class="n">Grid</span><span class="o">.</span><span class="n">from_vasp</span><span class="p">(</span><span class="n">charge_file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">reference_grid</span><span class="o">=</span><span class="n">reference_grid</span><span class="p">,</span> <span class="n">charge_grid</span><span class="o">=</span><span class="n">charge_grid</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.baderkit.core.badelf.Badelf.get_atom_results_dataframe" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_atom_results_dataframe</span><span class="p">()</span></code>

<a href="#src.baderkit.core.badelf.Badelf.get_atom_results_dataframe" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Collects a summary of results for the atoms in a pandas DataFrame.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>atoms_df</code></td>            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A table summarizing the atomic basins.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/baderkit/core/badelf/badelf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_atom_results_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Collects a summary of results for the atoms in a pandas DataFrame.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    atoms_df : pd.DataFrame</span>
<span class="sd">        A table summarizing the atomic basins.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get atom results summary</span>
    <span class="n">atom_frac_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electride_structure</span><span class="o">.</span><span class="n">frac_coords</span>
    <span class="n">atoms_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">electride_structure</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">atom_frac_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">atom_frac_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="n">atom_frac_coords</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
            <span class="s2">&quot;charge&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">charges</span><span class="p">,</span>
            <span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">volumes</span><span class="p">,</span>
            <span class="s2">&quot;surface_dist&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_surface_distances</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">atoms_df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.baderkit.core.badelf.Badelf.get_oxidation_from_potcar" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_oxidation_from_potcar</span><span class="p">(</span><span class="n">potcar_path</span><span class="o">=</span><span class="s1">&#39;POTCAR&#39;</span><span class="p">)</span></code>

<a href="#src.baderkit.core.badelf.Badelf.get_oxidation_from_potcar" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculates the oxidation state of each atom/electride using the
electron counts of the neutral atoms provided in a POTCAR.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>potcar_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Path to the POTCAR file. The default is "POTCAR".</p>
              </div>
            </td>
            <td>
                  <code>&#39;POTCAR&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>oxidation</code></td>            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The oxidation states of each atom/electride.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/baderkit/core/badelf/badelf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_oxidation_from_potcar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">potcar_path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;POTCAR&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the oxidation state of each atom/electride using the</span>
<span class="sd">    electron counts of the neutral atoms provided in a POTCAR.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    potcar_path : Path | str, optional</span>
<span class="sd">        The Path to the POTCAR file. The default is &quot;POTCAR&quot;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    oxidation : list</span>
<span class="sd">        The oxidation states of each atom/electride.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if POTCAR exists in path. If not, throw warning</span>
    <span class="n">potcar_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">potcar_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">potcar_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;No POTCAR file found in the requested directory. Oxidation states cannot be calculated&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span>
    <span class="c1"># get POTCAR info</span>
    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
        <span class="n">potcars</span> <span class="o">=</span> <span class="n">Potcar</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">potcar_path</span><span class="p">)</span>
    <span class="n">nelectron_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># the result is a list because there can be multiple element potcars</span>
    <span class="c1"># in the file (e.g. for NaCl, POTCAR = POTCAR_Na + POTCAR_Cl)</span>
    <span class="k">for</span> <span class="n">potcar</span> <span class="ow">in</span> <span class="n">potcars</span><span class="p">:</span>
        <span class="n">nelectron_data</span><span class="p">[</span><span class="n">potcar</span><span class="o">.</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="n">potcar</span><span class="o">.</span><span class="n">nelectrons</span>
    <span class="c1"># get valence electrons for each site in the structure</span>
    <span class="n">valence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">electride_structure</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">site</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">):</span>
        <span class="n">valence</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nelectron_data</span><span class="p">[</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">symbol</span><span class="p">]</span>
    <span class="c1"># subtract charges from valence to get oxidation</span>
    <span class="n">oxidation</span> <span class="o">=</span> <span class="n">valence</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">charges</span>
    <span class="k">return</span> <span class="n">oxidation</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.baderkit.core.badelf.Badelf.to_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_dict</span><span class="p">(</span><span class="n">potcar_path</span><span class="o">=</span><span class="s1">&#39;POTCAR&#39;</span><span class="p">,</span> <span class="n">use_json</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#src.baderkit.core.badelf.Badelf.to_dict" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Gets a dictionary summary of the BadELF analysis.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>potcar_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Path to a POTCAR file. This must be provided for oxidation states
to be calculated, and they will be None otherwise. The default is "POTCAR".</p>
              </div>
            </td>
            <td>
                  <code>&#39;POTCAR&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_json</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Convert all entries to JSONable data types. The default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A summary of the BadELF analysis in dictionary form.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/baderkit/core/badelf/badelf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">potcar_path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;POTCAR&quot;</span><span class="p">,</span> <span class="n">use_json</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Gets a dictionary summary of the BadELF analysis.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    potcar_path : Path | str, optional</span>
<span class="sd">        The Path to a POTCAR file. This must be provided for oxidation states</span>
<span class="sd">        to be calculated, and they will be None otherwise. The default is &quot;POTCAR&quot;.</span>
<span class="sd">    use_json : bool, optional</span>
<span class="sd">        Convert all entries to JSONable data types. The default is True.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        A summary of the BadELF analysis in dictionary form.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># collect method kwargs</span>
    <span class="n">method_kwargs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
        <span class="s2">&quot;shared_feature_splitting_method&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared_feature_splitting_method</span><span class="p">,</span>
        <span class="s2">&quot;elf_labeler_kwargs&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">elf_labeler_kwargs</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;method_kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">method_kwargs</span>

    <span class="c1"># only try to calculate oxidation state if this was a spin dependent system</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin_system</span> <span class="o">==</span> <span class="s2">&quot;total&quot;</span><span class="p">:</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;oxidation_states&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_oxidation_from_potcar</span><span class="p">(</span><span class="n">potcar_path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;oxidation_states&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># get charges first to ensure good logging</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">charges</span>

    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="s2">&quot;species&quot;</span><span class="p">,</span>
        <span class="s2">&quot;structure&quot;</span><span class="p">,</span>
        <span class="s2">&quot;labeled_structure&quot;</span><span class="p">,</span>
        <span class="s2">&quot;electride_structure&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nelectrides&quot;</span><span class="p">,</span>
        <span class="s2">&quot;all_electride_dims&quot;</span><span class="p">,</span>
        <span class="s2">&quot;all_electride_dim_cutoffs&quot;</span><span class="p">,</span>
        <span class="s2">&quot;electride_dimensionality&quot;</span><span class="p">,</span>
        <span class="s2">&quot;charges&quot;</span><span class="p">,</span>
        <span class="s2">&quot;volumes&quot;</span><span class="p">,</span>
        <span class="s2">&quot;elf_maxima&quot;</span><span class="p">,</span>
        <span class="s2">&quot;min_surface_distances&quot;</span><span class="p">,</span>
        <span class="s2">&quot;avg_surface_distances&quot;</span><span class="p">,</span>
        <span class="s2">&quot;electride_formula&quot;</span><span class="p">,</span>
        <span class="s2">&quot;electrides_per_formula&quot;</span><span class="p">,</span>
        <span class="s2">&quot;electrides_per_reduced_formula&quot;</span><span class="p">,</span>
        <span class="s2">&quot;total_electron_number&quot;</span><span class="p">,</span>
        <span class="s2">&quot;total_volume&quot;</span><span class="p">,</span>
        <span class="s2">&quot;spin_system&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vacuum_charge&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vacuum_volume&quot;</span><span class="p">,</span>
    <span class="p">]:</span>
        <span class="n">results</span><span class="p">[</span><span class="n">result</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">use_json</span><span class="p">:</span>
        <span class="c1"># get serializable versions of each attribute</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;structure&quot;</span><span class="p">,</span> <span class="s2">&quot;labeled_structure&quot;</span><span class="p">,</span> <span class="s2">&quot;electride_structure&quot;</span><span class="p">]:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;POSCAR&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;charges&quot;</span><span class="p">,</span>
            <span class="s2">&quot;volumes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;elf_maxima&quot;</span><span class="p">,</span>
            <span class="s2">&quot;oxidation_states&quot;</span><span class="p">,</span>
            <span class="s2">&quot;min_surface_distances&quot;</span><span class="p">,</span>
            <span class="s2">&quot;avg_surface_distances&quot;</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># skip oxidation states if they fail</span>
            <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.baderkit.core.badelf.Badelf.to_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_json</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#src.baderkit.core.badelf.Badelf.to_json" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Creates a JSON string representation of the results, typically for writing
results to file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments for the to_dict method.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A JSON string representation of the BadELF results.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/baderkit/core/badelf/badelf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a JSON string representation of the results, typically for writing</span>
<span class="sd">    results to file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    **kwargs : dict</span>
<span class="sd">        Keyword arguments for the to_dict method.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        A JSON string representation of the BadELF results.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">use_json</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.baderkit.core.badelf.Badelf.write_all_atom_volumes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_all_atom_volumes</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">write_reference</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">output_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">include_dummy_atoms</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">prefix_override</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">writer_kwargs</span><span class="p">)</span></code>

<a href="#src.baderkit.core.badelf.Badelf.write_all_atom_volumes" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Writes all atomic basins.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>directory</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The directory to write the files in. If None, the active directory
is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>directory</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The directory to write the files in. If None, the active directory
is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>write_reference</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to write the reference data rather than the charge data.
Default is False.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_format</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="baderkit.core.utilities.file_parsers.Format">Format</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The format to write with. If None, writes to source format stored in
the Grid objects metadata.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>include_dummy_atoms</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to include . The default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prefix_override</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The string to add at the front of the output path. If None, defaults
to the VASP file name equivalent to the data type stored in the
grid.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None.</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/baderkit/core/badelf/badelf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write_all_atom_volumes</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">write_reference</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">output_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Format</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">include_dummy_atoms</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">prefix_override</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">writer_kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes all atomic basins.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    directory : str | Path</span>
<span class="sd">        The directory to write the files in. If None, the active directory</span>
<span class="sd">        is used.</span>
<span class="sd">    directory : str | Path</span>
<span class="sd">        The directory to write the files in. If None, the active directory</span>
<span class="sd">        is used.</span>
<span class="sd">    write_reference : bool, optional</span>
<span class="sd">        Whether or not to write the reference data rather than the charge data.</span>
<span class="sd">        Default is False.</span>
<span class="sd">    output_format : str | Format, optional</span>
<span class="sd">        The format to write with. If None, writes to source format stored in</span>
<span class="sd">        the Grid objects metadata.</span>
<span class="sd">        Defaults to None.</span>
<span class="sd">    include_dummy_atoms : bool, optional</span>
<span class="sd">        Whether or not to include . The default is True.</span>
<span class="sd">    prefix_override : str, optional</span>
<span class="sd">        The string to add at the front of the output path. If None, defaults</span>
<span class="sd">        to the VASP file name equivalent to the data type stored in the</span>
<span class="sd">        grid.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">atom_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">electride_structure</span><span class="p">)))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write_volumes</span><span class="p">(</span>
        <span class="n">atom_indices</span><span class="o">=</span><span class="n">atom_indices</span><span class="p">,</span>
        <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span>
        <span class="n">write_reference</span><span class="o">=</span><span class="n">write_reference</span><span class="p">,</span>
        <span class="n">include_dummy_atoms</span><span class="o">=</span><span class="n">include_dummy_atoms</span><span class="p">,</span>
        <span class="n">output_format</span><span class="o">=</span><span class="n">output_format</span><span class="p">,</span>
        <span class="n">prefix_override</span><span class="o">=</span><span class="n">prefix_override</span><span class="p">,</span>
        <span class="o">**</span><span class="n">writer_kwargs</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.baderkit.core.badelf.Badelf.write_atom_tsv" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_atom_tsv</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="s1">&#39;badelf_atoms.tsv&#39;</span><span class="p">)</span></code>

<a href="#src.baderkit.core.badelf.Badelf.write_atom_tsv" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Writes a summary of atom results to .tsv files.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filepath</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Path to write the results to. The default is "badelf_atoms.tsv".</p>
              </div>
            </td>
            <td>
                  <code>&#39;badelf_atoms.tsv&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/baderkit/core/badelf/badelf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write_atom_tsv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;badelf_atoms.tsv&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes a summary of atom results to .tsv files.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filepath : str | Path</span>
<span class="sd">        The Path to write the results to. The default is &quot;badelf_atoms.tsv&quot;.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

    <span class="c1"># Get atom results summary</span>
    <span class="n">atoms_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_atom_results_dataframe</span><span class="p">()</span>
    <span class="n">formatted_atoms_df</span> <span class="o">=</span> <span class="n">atoms_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">numeric_cols</span> <span class="o">=</span> <span class="n">formatted_atoms_df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s2">&quot;number&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
    <span class="n">formatted_atoms_df</span><span class="p">[</span><span class="n">numeric_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">formatted_atoms_df</span><span class="p">[</span><span class="n">numeric_cols</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Determine max width per column including header</span>
    <span class="n">col_widths</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">col</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">),</span> <span class="n">formatted_atoms_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">atoms_df</span><span class="o">.</span><span class="n">columns</span>
    <span class="p">}</span>

    <span class="c1"># Note what we&#39;re writing in log</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Writing Atom Summary to </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># write output summaries</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="c1"># Write header</span>
        <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="si">:</span><span class="s2">&lt;</span><span class="si">{</span><span class="n">col_widths</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="si">}}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">formatted_atoms_df</span><span class="o">.</span><span class="n">columns</span>
        <span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Write rows</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">formatted_atoms_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">val</span><span class="si">:</span><span class="s2">&lt;</span><span class="si">{</span><span class="n">col_widths</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="si">}}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># f.write(f&quot;Vacuum Charge:\t\t{self.vacuum_charge:.5f}\n&quot;)</span>
        <span class="c1"># f.write(f&quot;Vacuum Volume:\t\t{self.vacuum_volume:.5f}\n&quot;)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Electrons:</span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total_electron_number</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.baderkit.core.badelf.Badelf.write_atom_volumes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_atom_volumes</span><span class="p">(</span><span class="n">atom_indices</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">write_reference</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">include_dummy_atoms</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">output_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix_override</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#src.baderkit.core.badelf.Badelf.write_atom_volumes" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Writes an the reference ELF or charge-density for the given atoms to
separate files. Electrides found during the calculation are appended to
the end of the structure.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>atom_indices</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index of the atom/electride to write for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>directory</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The directory to write the files in. If None, the active directory
is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>write_reference</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to write the reference data rather than the charge data.
Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>include_dummy_atoms</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to add dummy files to the structure. The default is False.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_format</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="baderkit.core.utilities.file_parsers.Format">Format</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The format to write with. If None, writes to source format stored in
the Grid objects metadata.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prefix_override</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The string to add at the front of the output path. If None, defaults
to the VASP file name equivalent to the data type stored in the
grid.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/baderkit/core/badelf/badelf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write_atom_volumes</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">atom_indices</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">write_reference</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">include_dummy_atoms</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">output_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Format</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">prefix_override</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Writes an the reference ELF or charge-density for the given atoms to</span>
<span class="sd">    separate files. Electrides found during the calculation are appended to</span>
<span class="sd">    the end of the structure.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atom_indices : int</span>
<span class="sd">        The index of the atom/electride to write for.</span>
<span class="sd">    directory : str | Path</span>
<span class="sd">        The directory to write the files in. If None, the active directory</span>
<span class="sd">        is used.</span>
<span class="sd">    write_reference : bool, optional</span>
<span class="sd">        Whether or not to write the reference data rather than the charge data.</span>
<span class="sd">        Default is True.</span>
<span class="sd">    include_dummy_atoms : bool, optional</span>
<span class="sd">        Whether or not to add dummy files to the structure. The default is False.</span>
<span class="sd">    output_format : str | Format, optional</span>
<span class="sd">        The format to write with. If None, writes to source format stored in</span>
<span class="sd">        the Grid objects metadata.</span>
<span class="sd">        Defaults to None.</span>
<span class="sd">    prefix_override : str, optional</span>
<span class="sd">        The string to add at the front of the output path. If None, defaults</span>
<span class="sd">        to the VASP file name equivalent to the data type stored in the</span>
<span class="sd">        grid.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>

    <span class="c1"># Get voxel assignments and data</span>
    <span class="n">voxel_assignment_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_labels</span>
    <span class="k">if</span> <span class="n">write_reference</span><span class="p">:</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_grid</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_grid</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># add dummy atoms if desired</span>
    <span class="k">if</span> <span class="n">include_dummy_atoms</span><span class="p">:</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electride_structure</span>

    <span class="c1"># get prefix</span>
    <span class="k">if</span> <span class="n">prefix_override</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prefix_override</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">data_type</span><span class="o">.</span><span class="n">prefix</span>

    <span class="c1"># Get mask where the grid belongs to requested species</span>
    <span class="k">for</span> <span class="n">atom_index</span> <span class="ow">in</span> <span class="n">atom_indices</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">voxel_assignment_array</span> <span class="o">==</span> <span class="n">atom_index</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">total</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">grid</span><span class="o">.</span><span class="n">diff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">diff</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">file_path</span> <span class="o">=</span> <span class="n">directory</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix_override</span><span class="si">}</span><span class="s2">_a</span><span class="si">{</span><span class="n">atom_index</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="c1"># write file</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">output_format</span><span class="o">=</span><span class="n">output_format</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.baderkit.core.badelf.Badelf.write_atom_volumes_sum" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_atom_volumes_sum</span><span class="p">(</span><span class="n">atom_indices</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">write_reference</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">output_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">include_dummy_atoms</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">prefix_override</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">writer_kwargs</span><span class="p">)</span></code>

<a href="#src.baderkit.core.badelf.Badelf.write_atom_volumes_sum" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Writes the reference ELF or charge-density for the the union of the
given atoms to a single file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>atom_indices</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index of the atom/electride to write for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>directory</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The directory to write the files in. If None, the active directory
is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>write_reference</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to write the reference data rather than the charge data.
Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>include_dummy_atoms</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to add dummy files to the structure. The default is False.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_format</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="baderkit.core.utilities.file_parsers.Format">Format</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The format to write with. If None, writes to source format stored in
the Grid objects metadata.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prefix_override</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The string to add at the front of the output path. If None, defaults
to the VASP file name equivalent to the data type stored in the
grid.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/baderkit/core/badelf/badelf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write_atom_volumes_sum</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">atom_indices</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span>
    <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">write_reference</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">output_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Format</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">include_dummy_atoms</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">prefix_override</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">writer_kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Writes the reference ELF or charge-density for the the union of the</span>
<span class="sd">    given atoms to a single file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atom_indices : int</span>
<span class="sd">        The index of the atom/electride to write for.</span>
<span class="sd">    directory : str | Path</span>
<span class="sd">        The directory to write the files in. If None, the active directory</span>
<span class="sd">        is used.</span>
<span class="sd">    write_reference : bool, optional</span>
<span class="sd">        Whether or not to write the reference data rather than the charge data.</span>
<span class="sd">        Default is True.</span>
<span class="sd">    include_dummy_atoms : bool, optional</span>
<span class="sd">        Whether or not to add dummy files to the structure. The default is False.</span>
<span class="sd">    output_format : str | Format, optional</span>
<span class="sd">        The format to write with. If None, writes to source format stored in</span>
<span class="sd">        the Grid objects metadata.</span>
<span class="sd">        Defaults to None.</span>
<span class="sd">    prefix_override : str, optional</span>
<span class="sd">        The string to add at the front of the output path. If None, defaults</span>
<span class="sd">        to the VASP file name equivalent to the data type stored in the</span>
<span class="sd">        grid.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># get the data to use</span>
    <span class="k">if</span> <span class="n">write_reference</span><span class="p">:</span>
        <span class="n">data_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_grid</span><span class="o">.</span><span class="n">total</span>
        <span class="n">data_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_grid</span><span class="o">.</span><span class="n">data_type</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_grid</span><span class="o">.</span><span class="n">total</span>
        <span class="n">data_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_grid</span><span class="o">.</span><span class="n">data_type</span>

    <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom_labels</span><span class="p">,</span> <span class="n">atom_indices</span><span class="p">)</span>
    <span class="n">data_array_copy</span> <span class="o">=</span> <span class="n">data_array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">data_array_copy</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">Grid</span><span class="p">(</span>
        <span class="n">structure</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="n">data_array_copy</span><span class="p">},</span>
        <span class="n">data_type</span><span class="o">=</span><span class="n">data_type</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># add dummy atoms if desired</span>
    <span class="k">if</span> <span class="n">include_dummy_atoms</span><span class="p">:</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electride_structure</span>

    <span class="c1"># get prefix</span>
    <span class="k">if</span> <span class="n">prefix_override</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prefix_override</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">data_type</span><span class="o">.</span><span class="n">prefix</span>

    <span class="n">file_path</span> <span class="o">=</span> <span class="n">directory</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix_override</span><span class="si">}</span><span class="s2">_asum&quot;</span>
    <span class="c1"># write file</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">output_format</span><span class="o">=</span><span class="n">output_format</span><span class="p">,</span> <span class="o">**</span><span class="n">writer_kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.baderkit.core.badelf.Badelf.write_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_json</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="s1">&#39;badelf.json&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#src.baderkit.core.badelf.Badelf.write_json" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Writes results of the analysis to file in a JSON format.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filepath</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Path to write the results to. The default is "badelf.json".</p>
              </div>
            </td>
            <td>
                  <code>&#39;badelf.json&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>keyword arguments for the to_dict method.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/baderkit/core/badelf/badelf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;badelf.json&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes results of the analysis to file in a JSON format.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filepath : Path | str, optional</span>
<span class="sd">        The Path to write the results to. The default is &quot;badelf.json&quot;.</span>
<span class="sd">    **kwargs : dict</span>
<span class="sd">        keyword arguments for the to_dict method.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">use_json</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="n">json_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.baderkit.core.badelf.Badelf.write_species_volume" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_species_volume</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">write_reference</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">species</span><span class="o">=</span><span class="n">FeatureType</span><span class="o">.</span><span class="n">bare_electron</span><span class="o">.</span><span class="n">dummy_species</span><span class="p">,</span> <span class="n">include_dummy_atoms</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">output_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix_override</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#src.baderkit.core.badelf.Badelf.write_species_volume" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Writes an ELFCAR or CHGCAR for a given species.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>directory</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The directory to write the result to. The default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>write_reference</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to write the reference data rather than the charge data.
The default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>species</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The species to write. The default is "Le" (the electrides).</p>
              </div>
            </td>
            <td>
                  <code><span title="baderkit.core.labelers.bifurcation_graph.enum_and_styling.FeatureType.bare_electron.dummy_species">dummy_species</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>include_dummy_atoms</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to include . The default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_format</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="baderkit.core.utilities.file_parsers.Format">Format</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The format to write with. If None, writes to source format stored in
the Grid objects metadata.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prefix_override</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The string to add at the front of the output path. If None, defaults
to the VASP file name equivalent to the data type stored in the
grid.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/baderkit/core/badelf/badelf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write_species_volume</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">write_reference</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">species</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">FeatureType</span><span class="o">.</span><span class="n">bare_electron</span><span class="o">.</span><span class="n">dummy_species</span><span class="p">,</span>
    <span class="n">include_dummy_atoms</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">output_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Format</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">prefix_override</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes an ELFCAR or CHGCAR for a given species.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    directory : str | Path, optional</span>
<span class="sd">        The directory to write the result to. The default is None.</span>
<span class="sd">    write_reference : bool, optional</span>
<span class="sd">        Whether or not to write the reference data rather than the charge data.</span>
<span class="sd">        The default is True.</span>
<span class="sd">    species : str, optional</span>
<span class="sd">        The species to write. The default is &quot;Le&quot; (the electrides).</span>
<span class="sd">    include_dummy_atoms : bool, optional</span>
<span class="sd">        Whether or not to include . The default is True.</span>
<span class="sd">    output_format : str | Format, optional</span>
<span class="sd">        The format to write with. If None, writes to source format stored in</span>
<span class="sd">        the Grid objects metadata.</span>
<span class="sd">        Defaults to None.</span>
<span class="sd">    prefix_override : str, optional</span>
<span class="sd">        The string to add at the front of the output path. If None, defaults</span>
<span class="sd">        to the VASP file name equivalent to the data type stored in the</span>
<span class="sd">        grid.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>

    <span class="c1"># Get voxel assignments and data</span>
    <span class="n">voxel_assignment_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_labels</span>
    <span class="k">if</span> <span class="n">write_reference</span><span class="p">:</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_grid</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_grid</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># add dummy atoms if desired</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electride_structure</span><span class="o">.</span><span class="n">indices_from_symbol</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">include_dummy_atoms</span><span class="p">:</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electride_structure</span>
    <span class="c1"># Get mask where the grid belongs to requested species</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">voxel_assignment_array</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">total</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">grid</span><span class="o">.</span><span class="n">diff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">diff</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># get prefix</span>
    <span class="k">if</span> <span class="n">prefix_override</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prefix_override</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">data_type</span><span class="o">.</span><span class="n">prefix</span>

    <span class="n">file_path</span> <span class="o">=</span> <span class="n">directory</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix_override</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">species</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="c1"># write file</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">output_format</span><span class="o">=</span><span class="n">output_format</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["content.code.annotate", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>